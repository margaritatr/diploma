-- -----------------------------------------------------
-- Description: Социальное обслуживание - база данных
-- -----------------------------------------------------

DROP DATABASE IF EXISTS diplom;
CREATE DATABASE diplom;
USE diplom;

-- -----------------------------------------------------
-- Роли пользователей
-- -----------------------------------------------------
CREATE TABLE roles (
    id INT AUTO_INCREMENT PRIMARY KEY,
    role_name VARCHAR(50) NOT NULL UNIQUE
);

-- -----------------------------------------------------
-- Территориальные центры
-- -----------------------------------------------------
CREATE TABLE territorial_centers (
    id INT AUTO_INCREMENT PRIMARY KEY,
    center_name VARCHAR(255) NOT NULL UNIQUE,
    director_full_name VARCHAR(255) NOT NULL
);

-- -----------------------------------------------------
-- Направления отделения
-- -----------------------------------------------------
CREATE TABLE departments (
    id INT AUTO_INCREMENT PRIMARY KEY,
    department_name VARCHAR(255) NOT NULL UNIQUE
);

-- -----------------------------------------------------
-- Пользователи
-- -----------------------------------------------------
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(150) NOT NULL UNIQUE,
    surname VARCHAR(150) NOT NULL,
    first_name VARCHAR(150) NOT NULL,
    patronymic VARCHAR(150) NOT NULL,
    password VARCHAR(150) NOT NULL,
    role_id INT NOT NULL,
    territorial_center_id INT,
    department_id INT,
    start_date DATE,
    FOREIGN KEY (role_id) REFERENCES roles(id),
    FOREIGN KEY (territorial_center_id) REFERENCES territorial_centers(id),
    FOREIGN KEY (department_id) REFERENCES departments(id)
);

-- -----------------------------------------------------
-- Функциональные классы
-- -----------------------------------------------------
CREATE TABLE functional_classes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    class_name VARCHAR(150) NOT NULL UNIQUE
);

-- -----------------------------------------------------
-- Клиенты
-- -----------------------------------------------------
CREATE TABLE clients (
    id INT AUTO_INCREMENT PRIMARY KEY,
    last_name VARCHAR(150) NOT NULL,
    first_name VARCHAR(150) NOT NULL,
    patronymic VARCHAR(150) NOT NULL,
    address VARCHAR(250) NOT NULL,
    func_class INT NOT NULL,
    user_id INT,
    contract_number VARCHAR(150) NOT NULL,
    contract_date DATE,
    contract_end_date DATE,
    birth_date DATE,
    phone_number VARCHAR(20),
    visit_count INT DEFAULT 0,
    status ENUM('Активен', 'Не активен'),
    gender ENUM('М', 'Ж'),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (func_class) REFERENCES functional_classes(id)
);

-- -----------------------------------------------------
-- Типы социальных услуг
-- -----------------------------------------------------
CREATE TABLE services_types (
    id INT AUTO_INCREMENT PRIMARY KEY,
    service_name VARCHAR(255) NOT NULL
);

-- -----------------------------------------------------
-- Оказанные услуги
-- -----------------------------------------------------
CREATE TABLE services (
    id INT AUTO_INCREMENT PRIMARY KEY,
    date DATE NOT NULL,
    service_type_id INT NOT NULL,
    social_worker_id INT,
    client_id INT,
    FOREIGN KEY (social_worker_id) REFERENCES users(id),
    FOREIGN KEY (client_id) REFERENCES clients(id),
    FOREIGN KEY (service_type_id) REFERENCES services_types(id)
);

-- -----------------------------------------------------
-- Связь между направлениями и центрами
-- -----------------------------------------------------
CREATE TABLE department_territorial_centers (
    department_id INT NOT NULL,
    territorial_center_id INT NOT NULL,
    PRIMARY KEY (department_id, territorial_center_id),
    FOREIGN KEY (department_id) REFERENCES departments(id) ON DELETE CASCADE,
    FOREIGN KEY (territorial_center_id) REFERENCES territorial_centers(id) ON DELETE CASCADE
);

-- -----------------------------------------------------
-- Связь функциональных классов и типов услуг
-- -----------------------------------------------------
CREATE TABLE functional_class_services_types (
    functional_class_id INT NOT NULL,
    service_type_id INT NOT NULL,
    PRIMARY KEY (functional_class_id, service_type_id),
    FOREIGN KEY (functional_class_id) REFERENCES functional_classes(id) ON DELETE CASCADE,
    FOREIGN KEY (service_type_id) REFERENCES services_types(id) ON DELETE CASCADE
);

-- -----------------------------------------------------
-- Первичные данные
-- -----------------------------------------------------

-- Роли
INSERT INTO roles (role_name) VALUES
('admin'), ('social_worker'), ('inspector');

-- Территориальные центры
INSERT INTO territorial_centers (center_name, director_full_name) VALUES
('ГУ «Территориальный центр социального обслуживания населения Заводского района г. Минска»', 'Абметко Наталья Александровна'),
('ГУ «Территориальный центр социального обслуживания населения Ленинского района г. Минска»', 'Томашева Ольга Леонидовна'),
('ГУ «Территориальный центр социального обслуживания населения Московского района г. Минска»', 'Жарикова Наталья Анатольевна'),
('ГУ «Территориальный центр социального обслуживания населения Октябрьского района г. Минска»', 'Жарикова Наталья Анатольевна'),
('ГУ «Территориальный центр социального обслуживания населения Партизанского района г. Минска»', 'Кухарчик Татьяна Александровна'),
('ГУ «Территориальный центр социального обслуживания населения Первомайского района г. Минска»', 'Давидовская Виктория Валентиновна'),
('ГУ «Территориальный центр социального обслуживания населения Советского района г. Минска»', 'Привалова Светлана Александровна'),
('ГУ «Территориальный центр социального обслуживания населения Фрунзенского района г. Минска»', 'Куиш Татьяна Анатольевна'),
('ГУ «Территориальный центр социального обслуживания населения Центрального района г. Минска»', 'Герасимова Инна Викторовна');

-- Отделения
INSERT INTO departments (department_name) VALUES
('Отделение социальной помощи на дому'),
('Отделение дневного пребывания для граждан пожилого возраста'),
('Отделение социальной реабилитации инвалидов'),
('Отделение социальной поддержки населения'),
('Отделение комплексной поддержки в кризисной ситуации'),
('Отделение первичного приёма, анализа, информирования и прогнозирования'),
('Отделение социальной реабилитации инвалидов');
-- Связь центры-отделения
INSERT INTO department_territorial_centers (department_id, territorial_center_id) VALUES
(1, 5),
(2, 5),
(3, 5),
(4, 5),
(5, 5),
(6, 5);


-- Функциональные классы
INSERT INTO functional_classes (class_name) VALUES ('ФК 2'), ('ФК 3'), ('ФК 4');

-- Пользователи ( необходимо вставить пользователей через скрипт add.py (ниже приведен пример вставки без хэшированного пароля)
INSERT INTO users (username, surname, first_name, patronymic, password, role_id, territorial_center_id, department_id, start_date) VALUES
('admin', 'Иванов', 'Иван', 'Иванович', 'adminpass', 1, 1, NULL, '2023-01-01'),
('social1', 'Петров', 'Петр', 'Петрович', 'socialpass', 2, 2, 1, '2024-01-01'),
('social2', 'Сидоров', 'Сидор', 'Сидорович', 'socialpass2', 2, 3, 1, '2023-01-01'),
('inspector1', 'Алексеева', 'Анна', 'Алексеевна', 'inspass', 3, 4, 1, '2024-01-01');

-- Клиенты
INSERT INTO clients (last_name, first_name, patronymic, address, func_class, user_id,contract_number, contract_date, contract_end_date,birth_date, phone_number, status, gender) VALUES
('Тарабарова', 'Арина', 'Игоревна', 'ул. Ленина 1, Минск', 3, 2, '12345', '2025-01-01', '2026-01-01','1980-05-15', '+375291111111', 'Активен', 'Ж'),
('Резникова', 'Елизавета', 'Сергеевна', 'ул. Победы 10, Минск', 2, 2,  '12346', '2025-02-01', '2026-02-01', '1975-06-20', '+375292222222', 'Активен', 'Ж'),
('Стахнов', 'Никита', 'Александрович', 'ул. Октябрьская 15, Минск', 3, 3,  '12347', '2025-03-01', '2026-03-01', '1990-07-10', '+375293333333', 'Активен', 'М'),
('Корсакова', 'Светлана', 'Константинован', 'ул. Советская 20, Минск', 4, 3,  '12348', '2025-04-01', '2026-04-01', '1985-10-25', '+375294444444', 'Активен', 'Ж');

-- Услуги
INSERT INTO services (date, service_type_id, social_worker_id, client_id) VALUES
('2025-01-15', 1, 2, 1),
('2025-02-20', 2, 2, 2),
('2025-03-25', 3, 3, 3),
('2025-04-30', 4, 3, 4);

-- Услуги
INSERT INTO services_types (service_name) VALUES 
('Консультирование и информирование по вопросам оказания социальных услуг и социальной поддержки'),
('Содействие в оформлении необходимых документов для реализации права на социальную поддержку и социальное обслуживание'),
('Содействие в истребовании необходимых документов для реализации права на социальную поддержку и социальное обслуживание'),
('Проведение информационных бесед'),
('Обучение пользованию компьютерной техникой, мобильным телефоном'),
('Обеспечение книгами, журналами, газетами'),
('Чтение вслух журналов, газет, книг'),
('Оказание помощи в посещении храма, организация встреч и духовных бесед со служителями храма'),
('Содействие в восстановлении и поддержании родственных связей, содействие в восстановлении (замене) документов, удостоверяющих личность и подтверждающих право на льготы', TRUE),
('Содействие в получении социальных услуг, предоставляемых организациями, оказывающими социальные услуги'),
('Содействие в получении услуг, предоставляемых организациями торговли, бытового обслуживания, связи и другими организациями'),
('Содействие (оказание помощи) в доставке и обратно в учреждения (организации), здравоохранения, образования, культуры'),
('Сопровождение в государственные организации здравоохранения'),
('Содействие в заготовке овощей на зиму'),
('Содействие в организации ритуальных услуг'),
('Содействие в организации получения медицинской помощи'),
('Содействие в заготовке топлива (для проживающих в жилых помещениях без центрального отопления)'),
('Социально-психологические услуги – консультирование, коррекция'),
('Психологическая профилактика, психологическое просвещение');


INSERT INTO functional_class_services_types (functional_class_id, service_type_id) VALUES
(2, 1),  -- Консультирование
(2, 2),  -- Содействие в оформлении документов
(2, 3),  -- Содействие в истребовании документов
(2, 4),  -- Проведение информационных бесед
(2, 5),  -- Обучение пользованию техникой
(2, 6),  -- Обеспечение книгами
(2, 7),  -- Чтение вслух
(2, 8),  -- Оказание помощи в посещении храма
(2, 9),  -- Содействие в восстановлении родственных связей
(2, 10), -- Содействие в получении социальных услуг
(2, 11),  -- Содействие в получении услуг от организаций
(2, 12),  -- Содействие в доставке в учреждения
(2, 13),  -- Сопровождение в организации здравоохранения
(2, 14),  -- Содействие в заготовке овощей
(2, 15),  -- Содействие в организации ритуальных услуг
(2, 16),  -- Содействие в получении медицинской помощи
(2, 17),  -- Содействие в заготовке топлива
(2, 18),  -- Социально-психологические услуги
(2, 19);  -- Психологическая профилактика


INSERT INTO functional_class_services_types (functional_class_id, service_type_id) VALUES
(3, 1),  -- Консультирование
(3, 2),  -- Содействие в оформлении документов
(3, 3),  -- Содействие в истребовании документов
(3, 4),  -- Проведение информационных бесед
(3, 5),  -- Обучение пользованию техникой
(3, 6),  -- Обеспечение книгами
(3, 7),  -- Чтение вслух
(3, 8),  -- Оказание помощи в посещении храма
(3, 9),  -- Содействие в восстановлении родственных связей
(3, 10), -- Содействие в получении социальных услуг
(3, 11),  -- Содействие в получении услуг от организаций
(3, 12),  -- Содействие в доставке в учреждения
(3, 13),  -- Сопровождение в организации здравоохранения
(3, 14),  -- Содействие в заготовке овощей
(3, 15),  -- Содействие в организации ритуальных услуг
(3, 16),  -- Содействие в получении медицинской помощи
(3, 17),  -- Содействие в заготовке топлива
(3, 18),  -- Социально-психологические услуги
(3, 19);  -- Психологическая профилактика


INSERT INTO functional_class_services_types ( functional_class_id, service_type_id) VALUES
(4, 1),  -- Консультирование
(4, 2),  -- Содействие в оформлении документов
(4, 3),  -- Содействие в истребовании документов
(4, 4),  -- Проведение информационных бесед
(4, 5),  -- Обучение пользованию техникой
(4, 6),  -- Обеспечение книгами
(4, 7),  -- Чтение вслух
(4, 8),  -- Оказание помощи в посещении храма
(4, 9),  -- Содействие в восстановлении родственных связей
(4, 10), -- Содействие в получении социальных услуг
(4, 11),  -- Содействие в получении услуг от организаций
(4, 12),  -- Содействие в доставке в учреждения
(4, 13),  -- Сопровождение в организации здравоохранения
(4, 14),  -- Содействие в заготовке овощей
(4, 15),  -- Содействие в организации ритуальных услуг
(4, 16),  -- Содействие в получении медицинской помощи
(4, 17),  -- Содействие в заготовке топлива
(4, 18),  -- Социально-психологические услуги
(4, 19);  -- Психологическая профилактика

INSERT INTO services_types (service_name) VALUES 
('Покупка и доставка на дом продуктов питания, промышленных товаров первой необходимости'),
('Доставка на дом горячего питания при необходимости'),
('Доставка (обеспечение) лекарственных средств и изделий медицинского назначения при необходимости'),
('Оказание помощи в приготовлении пищи'), 
('Приготовление простых блюд'),  
('Доставка воды'),  
('Доставка овощей из хранилища'), 
('Помощь в растопке печей (без центрального отопления)'), 
('Помощь в растопке печей (без центрального отопления)'),  
('Сдача вещей в стирку, химчистку, ремонт и их доставка на дом'),  
('Протирание пыли с поверхности мебели'),  
('Вынос мусора'),  
('Подметание пола'),  
('Уборка пылесосом мягкой мебели, ковров и напольных покрытий'),  
('Чистка прикроватных ковриков и дорожек'),  
('Мытье пола'),  
('Мытье оконных стекол и оконных переплетов, протирание подоконников, очистка оконных рам от бумаги'),
('Смена штор и гардин'),  
('Чистка ванны, умывальника (раковины)'),  
('Чистка газовой (электрической) плиты'),  
('Мытье посуды'),  
('Уборка пыли со стен и потолков'),  
('Чистка унитаза'),  
('Мытье холодильника'),  
('Внесение платы из средств обслуживаемого лица за жилищно-коммунальные услуги, пользование жилым помещением, услуги связи'),  
('Очистка придомовых дорожек от снега в зимний период'),  
('Уборка придомовой территории'),  
('Оказание помощи в смене нательного белья, одевании, снятии одежды, переодевании'),  
('Оказание помощи в смене (перестилании) постельного белья'),  
('Оказание помощи в приеме пищи (КОРМЛЕНИЕ)'),  
('Причесывание'),  
('Помощь в принятии ванны (душа)'),  
('Мытье головы, бритье бороды и усов'),  
('Гигиеническая обработка рук и ног (стрижка ногтей)'),  
('Смена подгузника'),  
('Вынос судна'),  
('Организация прогулки на свежем воздухе'), 
('Оказание помощи в выполнении назначений, рекомендаций медицинского работника'),  
('Содействие в выполнении реабилитационных мероприятий'),  
('Помощь в обеспечении техническими средствами социальной реабилитации'),  
('Обучение пользованию техническими средствами социальной реабилитации');


INSERT INTO functional_class_services_types (functional_class_id, service_type_id) VALUES
(2, 20), 
(3, 20),
(4, 20),
(4, 21),  -- Доставка на дом горячего питания
(2, 21),  
(3, 21),  
(4, 22),  -- Доставка лекарств
(2, 22),  
(3, 22), 
(3, 23),  -- Оказание помощи в приготовлении пищи
(4, 23),
(3, 24),  -- Приготовление простых блюд
(4, 24),
(3, 25),  -- Доставка воды
(2, 25),
(4, 25),
(3, 26),  -- Доставка овощей
(4, 26); 

